<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyPi - User Dashboard</title>
    <link rel="icon" type="image/png" href="../assets/titlelogo.png">

    <link rel="stylesheet" href="../css/general_components.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>

<body>
  <!-- Navbar -->
   <div id="navbar-container"></div>

  <!-- Content -->
  <div class="content-wrapper">
  <div id="sidebar-container"></div>

    <!-- Scrollable Main Content -->
    <div class="main-content">
      <!-- Main Content (add margin-left to avoid overlap) -->
      <div style="margin-left:10px; width:100%;">
        <div class="container py-4" style="max-width:1400px;">
          <div class="bg-white rounded-4 shadow-sm p-4" style="border:1px solid #e3e3e3;">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h3 class="fw-bold" style="color:#222;">
                <span style="border-bottom:3px solid #ff6b6b;">Task Categories</span>
              </h3>
              <a href="dashboard.html" class="fw-semibold" style="color:#222; text-decoration:underline;">Go Back</a>
            </div>

            <!-- Task Status Table -->
            <div class="mb-4">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="fw-semibold" style="color:#222; border-bottom:2px solid #ff6b6b;">Task Status</span>
                <a href="#" class="fw-semibold" style="color:#ff6b6b; text-decoration:none; font-size:1rem;"
                  data-bs-toggle="modal" data-bs-target="#addTaskStatusModal">+ Add Task Status</a>
              </div>
              <div class="table-responsive">
                <table id="taskStatusTable" class="table table-bordered align-middle"
                  style="border-radius:12px; overflow:hidden;">
                  <thead>
                    <tr style="background:#f7f7f7;">
                      <th style="width:60px;">SN</th>
                      <th>Task Status</th>
                      <th style="width:200px;">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr id="noTaskStatusRow">
                      <td colspan="3" class="text-center text-muted">No Task Status, please create your Task Status</td>
                    </tr>
                    <!-- Existing status rows go here -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Task Priority Table -->
            <div class="mb-4">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="fw-semibold" style="color:#222; border-bottom:2px solid #ff6b6b;">Task Priority</span>
                <a href="#" class="fw-semibold" style="color:#ff6b6b; text-decoration:none; font-size:1rem;"
                  data-bs-toggle="modal" data-bs-target="#addTaskPriorityModal">+ Add Task Priority</a>
              </div>
              <div class="table-responsive">
                <table id="taskPriorityTable" class="table table-bordered align-middle"
                  style="border-radius:12px; overflow:hidden;">
                  <thead>
                    <tr style="background:#f7f7f7;">
                      <th style="width:60px;">SN</th>
                      <th>Task Priority</th>
                      <th style="width:200px;">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr id="noTaskPriorityRow">
                      <td colspan="3" class="text-center text-muted">No Task Priority, please create your Task Priority
                      </td>
                    </tr>
                    <!-- Existing priority rows go here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Task Status Modal -->
    <div class="modal fade" id="addTaskStatusModal" tabindex="-1" aria-labelledby="addTaskStatusModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addTaskStatusModalLabel">Add Task Status</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="taskStatusName" class="form-label">Task Status Name</label>
                <input type="text" class="form-control" id="taskStatusName" placeholder="Enter status name">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn" style="background:#ff6b6b; color:white;" onclick="addTaskStatus()">Add
              Status</button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Add Task Status Modal -->

    <!-- Edit Task Status Modal -->
    <div class="modal fade" id="editTaskStatusModal" tabindex="-1" aria-labelledby="editTaskStatusModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editTaskStatusModalLabel">Edit Task Status</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="editTaskStatusName" class="form-label">Task Status Name</label>
                <input type="text" class="form-control" id="editTaskStatusName">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn" style="background:#ff6b6b; color:white;"
              id="saveTaskStatusEdit">Save</button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Edit Task Status Modal -->

    <!-- Add Task Priority Modal -->
    <div class="modal fade" id="addTaskPriorityModal" tabindex="-1" aria-labelledby="addTaskPriorityModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addTaskPriorityModalLabel">Add Task Priority</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="taskPriorityName" class="form-label">Task Priority Name</label>
                <input type="text" class="form-control" id="taskPriorityName" placeholder="Enter priority name">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn" style="background:#ff6b6b; color:white;" onclick="addTaskPriority()">Add
              Priority</button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Add Task Priority Modal -->

    <!-- Edit Task Priority Modal -->
    <div class="modal fade" id="editTaskPriorityModal" tabindex="-1" aria-labelledby="editTaskPriorityModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editTaskPriorityModalLabel">Edit Task Priority</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="editTaskPriorityName" class="form-label">Task Priority Name</label>
                <input type="text" class="form-control" id="editTaskPriorityName">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn" style="background:#ff6b6b; color:white;"
              id="saveTaskPriorityEdit">Save</button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Edit Task Priority Modal -->
  </div>
  <div id="chatbot-container"></div>

  <script>
    let currentEditRow = null;
    let currentEditType = null;
    let currentEditPriorityRow = null;

    function showEditModal(btn, tableId) {
      currentEditRow = btn.closest('tr');
      currentEditType = tableId;
      const nameCell = currentEditRow.cells[1];
      const currentValue = nameCell.textContent;

      if (tableId === 'taskStatusTable') {
        document.getElementById('editTaskStatusName').value = currentValue;
        const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('editTaskStatusModal'));
        modal.show();
      }
    }

    function showEditPriorityModal(btn) {
      currentEditPriorityRow = btn.closest('tr');
      const nameCell = currentEditPriorityRow.cells[1];
      document.getElementById('editTaskPriorityName').value = nameCell.textContent;
      const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('editTaskPriorityModal'));
      modal.show();
    }

    document.getElementById('saveTaskStatusEdit').onclick = function () {
      if (currentEditRow && currentEditType === 'taskStatusTable') {
        const newValue = document.getElementById('editTaskStatusName').value.trim();
        if (newValue) currentEditRow.cells[1].textContent = newValue;
        bootstrap.Modal.getOrCreateInstance(document.getElementById('editTaskStatusModal')).hide();
      }
    };

    document.getElementById('saveTaskPriorityEdit').onclick = function () {
      if (currentEditPriorityRow) {
        const newValue = document.getElementById('editTaskPriorityName').value.trim();
        if (newValue) currentEditPriorityRow.cells[1].textContent = newValue;
        bootstrap.Modal.getOrCreateInstance(document.getElementById('editTaskPriorityModal')).hide();
      }
    };

    function addTaskStatus() {
      const input = document.getElementById('taskStatusName');
      const value = input.value.trim();
      if (!value) return;

      const table = document.getElementById('taskStatusTable').getElementsByTagName('tbody')[0];

      // Remove "No Task Status" row if present
      const noStatusRow = document.getElementById('noTaskStatusRow');
      if (noStatusRow) noStatusRow.remove();

      const rowCount = table.rows.length + 1;
      const newRow = table.insertRow();
      newRow.innerHTML = `
    <td>${rowCount}</td>
    <td>${value}</td>
    <td>
      <button class="btn btn-sm" onclick="showEditModal(this, 'taskStatusTable')" style="background:#ff6b6b; color:white; border-radius:6px;">
        <i class="bi bi-pencil-square"></i> Edit
      </button>
      <button class="btn btn-sm ms-2" onclick="deleteRow(this)" style="background:#ff6b6b; color:white; border-radius:6px;">
        <i class="bi bi-trash"></i> Delete
      </button>
    </td>
  `;

      input.value = '';
      const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('addTaskStatusModal'));
      modal.hide();
    }

    // Delete row function for Task Status table only
    function deleteRow(btn) {
      const row = btn.closest('tr');
      const tableBody = row.parentNode;
      row.remove();
      updateSerialNumbers('taskStatusTable');

      // Check Task Status table for remaining data rows
      if (tableBody === document.getElementById('taskStatusTable').getElementsByTagName('tbody')[0]) {
        let actualRows = 0;
        for (let r of tableBody.rows) {
          if (r.id !== 'noTaskStatusRow') actualRows++;
        }
        if (actualRows === 0) {
          const noStatusRow = document.createElement('tr');
          noStatusRow.id = 'noTaskStatusRow';
          noStatusRow.innerHTML = `<td colspan="3" class="text-center text-muted">No Task Status, please create your Task Status</td>`;
          tableBody.appendChild(noStatusRow);
        }
      }
    }

    function addTaskPriority() {
      const input = document.getElementById('taskPriorityName');
      const value = input.value.trim();
      if (!value) return;

      const table = document.getElementById('taskPriorityTable').getElementsByTagName('tbody')[0];

      // Remove "No Task Priority" row if present
      const noPriorityRow = document.getElementById('noTaskPriorityRow');
      if (noPriorityRow) noPriorityRow.remove();

      const rowCount = table.rows.length + 1;
      const newRow = table.insertRow();
      newRow.innerHTML = `
    <td>${rowCount}</td>
    <td>${value}</td>
    <td>
      <button class="btn btn-sm" onclick="showEditPriorityModal(this)" style="background:#ff6b6b; color:white; border-radius:6px;">
        <i class="bi bi-pencil-square"></i> Edit
      </button>
      <button class="btn btn-sm ms-2" onclick="deletePriorityRow(this)" style="background:#ff6b6b; color:white; border-radius:6px;">
        <i class="bi bi-trash"></i> Delete
      </button>
    </td>
  `;

      input.value = '';
      const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('addTaskPriorityModal'));
      modal.hide();
      updateSerialNumbers('taskPriorityTable');
    }

    function deletePriorityRow(btn) {
      const row = btn.closest('tr');
      const tableBody = row.parentNode;
      row.remove();
      updateSerialNumbers('taskPriorityTable');

      // Check Task Priority table for remaining data rows
      if (tableBody === document.getElementById('taskPriorityTable').getElementsByTagName('tbody')[0]) {
        let actualRows = 0;
        for (let r of tableBody.rows) {
          if (r.id !== 'noTaskPriorityRow') actualRows++;
        }
        if (actualRows === 0) {
          const noPriorityRow = document.createElement('tr');
          noPriorityRow.id = 'noTaskPriorityRow';
          noPriorityRow.innerHTML = `<td colspan="3" class="text-center text-muted">No Task Priority, please create your Task Priority</td>`;
          tableBody.appendChild(noPriorityRow);
        }
      }
    }

    // Update SN numbers after deletion or addition for both tables
    function updateSerialNumbers(tableId) {
      const table = document.getElementById(tableId);
      if (!table) return;
      const rows = table.getElementsByTagName('tbody')[0].rows;
      let sn = 1;
      for (let i = 0; i < rows.length; i++) {
        // Skip message row
        if ((tableId === 'taskStatusTable' && rows[i].id === 'noTaskStatusRow') ||
          (tableId === 'taskPriorityTable' && rows[i].id === 'noTaskPriorityRow')) {
          rows[i].cells[0].textContent = ""; // Remove SN for message row
          continue;
        }
        rows[i].cells[0].textContent = sn++;
      }
    }
  </script>
  <script type="importmap">
  {
    "imports": {
      "@google/generative-ai": "https://esm.run/@google/generative-ai"
    }
  }
</script>
<script type="module" src="../scripts/components.js"></script>
<script type="module" src="../scripts/chatbot.js"></script>


</body>

</html>